name: Build QTBase for Linux
  
agent:
  type: Unity::VM
  image: slough-ops/ubuntu-16.04-base:stable
  flavor: b1.xlarge

artifacts:
  qtbase-linux.zip:
    paths:
      - build/builds.7z

commands:
  - echo "Allowed source repositories"
  - sudo apt-get update -y
  - sudo apt-get upgrade -y
  - sudo apt-get install chrpath -y
  - sudo apt-get build-dep qt5-default -y
  - sudo apt-get install libxcb-xinerama0-dev -y
  - sudo apt-get install libx11-xcb-dev -y
  - sudo apt-get install libxkbcommon-dev -y
  - sudo apt install p7zip-full p7zip-rar -y
  - cd /home/bokken/build/output/Unity-Technologies/qtbase
  - git clone https://github.com/openssl/openssl
  - git -C /home/bokken/build/output/Unity-Technologies/qtbase/openssl checkout -b 1.0.2 origin/OpenSSL_1_0_2-stable
  - perl build.pl --arch=64

triggers:
  pushes:
    only:
      - qtbuild.5.13.2
      - qtbuild.5.13.2-linux
